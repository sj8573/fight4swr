import React, { useState } from 'react';
import { BookOpen, CheckSquare, ChevronRight, ChevronLeft, Info, List, Menu, X, Award, HelpCircle, CheckCircle, XCircle } from 'lucide-react';

// ==========================================
// å…§å®¹è³‡æ–™åº« (Content Data)
// ==========================================
const PAGE_DATA = {
  title: "ç‚ºä½•è¦å­¸ç¿’ç ”ç©¶æ–¹æ³•ï¼Ÿ",
  subtitle: "ç¤¾æœƒå·¥ä½œç ”ç©¶æ–¹æ³•è«–",
  intro: "è¨±å¤šç¤¾å·¥å­¸ç”Ÿæœƒå•ï¼šã€Œæˆ‘æœªä¾†è¦ç•¶åŠ©äººè€…ï¼Œç‚ºä»€éº¼è¦å­¸ç ”ç©¶æ–¹æ³•ï¼Ÿã€ç­”æ¡ˆå¾ˆç°¡å–®ï¼šç†±æƒ…èˆ‡å–„æ„ä¸è¶³ä»¥ä¿è­‰æœå‹™æœ‰æ•ˆã€‚å­¸ç¿’ç ”ç©¶æ–¹æ³•èƒ½å¹«åŠ©æˆ‘å€‘è¶…è¶Šç›´è¦ºã€è©•ä¼°æˆæ•ˆã€è² è²¬ä»»åœ°é‹ç”¨è³‡æºï¼Œä¸¦é¿å…å°æ¡ˆä¸»é€ æˆç„¡æ„çš„å‚·å®³ã€‚",
  
  // Tab 1: æ ¸å¿ƒçŸ¥è­˜ (Reading)
  sections: [
    {
      id: "science",
      title: "ğŸ§ª ç§‘å­¸æ–¹æ³•çš„å››å¤§ç‰¹æ€§",
      content: `ç§‘å­¸ä¸¦éæŒ‡ç‰¹å®šçš„å­¸ç§‘ï¼Œè€Œæ˜¯ä¸€ç¨®ã€Œè¿½æ±‚çŸ¥è­˜çš„æ…‹åº¦èˆ‡ç¨‹åºã€ã€‚
      
1. **ç³»çµ±æ€§ (Systematic)**ï¼š
   ç ”ç©¶æ˜¯æœ‰è¨ˆç•«ã€æœ‰æ­¥é©Ÿçš„ã€‚ä¸èƒ½æ†‘æ„Ÿè¦ºï¼Œå¿…é ˆè¨­è¨ˆåš´è¬¹çš„ç¨‹åºï¼ˆå¦‚å‰æ¸¬ã€å¾Œæ¸¬ã€æ§åˆ¶çµ„ï¼‰ã€‚

2. **ç¶“é©—æ€§ (Empirical)**ï¼š
   çµè«–å»ºç«‹åœ¨ã€Œå¯è§€å¯Ÿã€å¯æ¸¬é‡ã€çš„è­‰æ“šä¸Šã€‚ä¾‹å¦‚ï¼šã€Œæ•¸æ“šé¡¯ç¤ºæ†‚é¬±åˆ†æ•¸ä¸‹é™5åˆ†ã€å„ªæ–¼ã€Œæˆ‘è¦ºå¾—ä»–è®Šå¥½äº†ã€ã€‚

3. **å¯é©—è­‰æ€§ / å¯è¤‡è£½æ€§ (Verifiable / Replicable)**ï¼š
   ç ”ç©¶éç¨‹å¿…é ˆé€æ˜ï¼Œè®“ä»–äººèƒ½åœ¨ç›¸åŒæ¢ä»¶ä¸‹ã€Œè¤‡è£½ã€ä¸¦æª¢é©—çµæœï¼Œç¢ºä¿ç™¼ç¾ä¸æ˜¯å¶ç„¶ã€‚

4. **æš«å®šæ€§ (Tentative)**ï¼š
   ç§‘å­¸çŸ¥è­˜æ˜¯æš«æ™‚çš„ï¼Œæ°¸é å°æ–°çš„è­‰æ“šä¿æŒé–‹æ”¾ã€‚ä¾‹å¦‚ï¼šæˆ‘å€‘å°æœ€ä½³å®‰ç½®æ¨¡å¼çš„ç†è§£ï¼Œéš¨è‘—ä¾é™„ç†è«–çš„ç ”ç©¶è€Œæ”¹è®Šã€‚`
    },
    {
      id: "errors",
      title: "ğŸ§ å¸¸è¦‹çš„è§€å¯Ÿè¬¬èª¤",
      content: `äººé¡çš„ç›´è¦ºå¸¸å……æ»¿åèª¤ï¼Œç ”ç©¶æ–¹æ³•èƒ½å¹«åŠ©æˆ‘å€‘å…‹æœé€™äº›é™·é˜±ï¼š

1. **éåº¦æ¦‚åŒ– (Overgeneralization)**ï¼š
   åƒ…æ ¹æ“šå°‘æ•¸ç‰¹ä¾‹ï¼ˆå¦‚2å€‹å€‹æ¡ˆï¼‰å°±è‰ç‡å°å…¨é«”ä¸‹çµè«–ã€‚

2. **é¸æ“‡æ€§è§€å¯Ÿ (Selective Observation)**ï¼š
   å¿ƒä¸­å·²æœ‰å®šè¦‹ï¼Œåªçœ‹è¦‹æ”¯æŒè‡ªå·±çš„è­‰æ“šï¼Œè‡ªå‹•å¿½ç•¥åé§çš„è­‰æ“šï¼ˆå¦‚åªçœ‹æˆåŠŸçš„å€‹æ¡ˆï¼Œå¿½ç•¥å¤±æ•—è€…ï¼‰ã€‚

3. **æœˆæšˆæ•ˆæ‡‰ (Halo Effect)**ï¼š
   å› ç‚ºæŸäººçš„ä¸€å€‹æ­£é¢ç‰¹è³ªï¼ˆå¦‚å¤–è¡¨å¾—é«”ï¼‰ï¼Œå°±éŒ¯èª¤æ¨è«–ä»–åœ¨å…¶ä»–æ–¹é¢ï¼ˆå¦‚è¦ªè·èƒ½åŠ›ï¼‰ä¹Ÿå¾ˆå„ªç§€ã€‚

4. **éé‚è¼¯æ¨è«– (Illogical Reasoning)**ï¼š
   ä½¿ç”¨éŒ¯èª¤é‚è¼¯è§£é‡‹äº‹ä»¶ï¼Œä¾‹å¦‚ã€Œè³­å¾’è¬¬èª¤ã€ï¼ˆè¦ºå¾—å€’æ¥£ä¹…äº†ä¸‹æ¬¡ä¸€å®šæœƒæˆåŠŸï¼‰ã€‚`
    },
    {
      id: "ebp_intro",
      title: "ğŸ’¡ è­‰æ“šæœ¬ä½å¯¦å‹™ (EBP)",
      content: `EBP (Evidence-Based Practice) æ˜¯æ•´åˆæ€§çš„æ±ºç­–éç¨‹ã€‚ç¤¾å·¥çš„æœ€ä½³æ±ºç­–æ‡‰æ˜¯ä»¥ä¸‹ä¸‰è€…çš„äº¤é›†ï¼š
      
1. **æœ€ä½³ç ”ç©¶è­‰æ“š** (Best Research Evidence)
2. **å¯¦å‹™å°ˆæ¥­èˆ‡ç¶“é©—** (Practitioner Expertise)
3. **æ¡ˆä¸»åƒ¹å€¼èˆ‡åå¥½** (Client Values & Preferences)

EBP å¼·èª¿æˆ‘å€‘ä¸æ‡‰ç›²ç›®è·Ÿéš¨è­‰æ“šï¼Œè€Œæ‡‰çµåˆå°ˆæ¥­åˆ¤æ–·èˆ‡æ¡ˆä¸»æ„é¡˜ã€‚`
    }
  ],

  // Tab 2: EBP åŸ·è¡Œæ­¥é©Ÿ (Steps)
  steps: [
    {
      title: "Step 1: æå• (Ask)",
      description: "å°‡å¯¦å‹™ä¸Šé‡åˆ°çš„é›£é¡Œï¼Œè½‰åŒ–ç‚ºä¸€å€‹çµæ§‹åŒ–ã€å¯å›ç­”çš„å•é¡Œ (PICO)ã€‚",
      tips: "ä¾‹å¦‚ï¼šå°æ–¼PTSDé’å°‘å¹´(P)ï¼ŒèªçŸ¥è¡Œç‚ºæ²»ç™‚(I)æ˜¯å¦æ¯”ä¸€èˆ¬è«®å•†(C)æ›´èƒ½é™ä½ç„¦æ…®(O)ï¼Ÿ"
    },
    {
      title: "Step 2: å°‹æ‰¾ (Acquire)",
      description: "åˆ©ç”¨é—œéµå­—åœ¨å­¸è¡“è³‡æ–™åº«ï¼ˆå¦‚ Cochrane, Airitiï¼‰ä¸­ç³»çµ±æ€§åœ°æœå°‹æœ€ä½³çš„ç ”ç©¶è­‰æ“šã€‚",
      tips: "ç›¡é‡å°‹æ‰¾ç­‰ç´šè¼ƒé«˜è­‰æ“šï¼Œå¦‚ç³»çµ±æ€§å›é¡§ (Systematic Review) æˆ–éš¨æ©Ÿå°ç…§è©¦é©— (RCT)ã€‚"
    },
    {
      title: "Step 3: è©•ä¼° (Appraise)",
      description: "ä¸åƒ…æ˜¯é–±è®€ï¼Œé‚„è¦åš´æ ¼è©•ä¼°é€™ä»½è­‰æ“šçš„ã€Œå¯ä¿¡åº¦ã€(Validity) èˆ‡ã€Œé©ç”¨æ€§ã€ã€‚",
      tips: "é€™ä»½ç ”ç©¶çš„æ–¹æ³•åš´è¬¹å—ï¼Ÿå®ƒçš„çµæœèƒ½æ‡‰ç”¨åœ¨æˆ‘çš„æ¡ˆä¸»èº«ä¸Šå—ï¼Ÿ"
    },
    {
      title: "Step 4: æ‡‰ç”¨ (Apply)",
      description: "å°‡è©•ä¼°å¾Œçš„è­‰æ“šï¼Œçµåˆç¤¾å·¥çš„å°ˆæ¥­ç¶“é©—ä»¥åŠæ¡ˆä¸»çš„åƒ¹å€¼è§€ï¼Œå…±åŒåšå‡ºæ±ºç­–ã€‚",
      tips: "å¦‚æœæ¡ˆä¸»æ’æ–¥æŸç¨®ç™‚æ³•ï¼Œå³ä½¿è­‰æ“šèªªå®ƒæœ€æœ‰æ•ˆï¼Œæˆ‘å€‘ä¹Ÿæ‡‰èª¿æ•´æˆ–å°‹æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚"
    },
    {
      title: "Step 5: è©•é‘‘ (Assess)",
      description: "åŸ·è¡Œä»‹å…¥å¾Œï¼Œå¿…é ˆå®¢è§€è©•ä¼°åŸ·è¡Œçš„æˆæ•ˆï¼Œä¸¦é€²è¡Œåæ€èˆ‡ä¿®æ­£ã€‚",
      tips: "ä½¿ç”¨é‡è¡¨æˆ–å…·é«”æŒ‡æ¨™ä¾†ç¢ºèªå•é¡Œæ˜¯å¦è§£æ±ºï¼Œä½œç‚ºä¸‹ä¸€æ¬¡å¾ªç’°çš„åŸºç¤ã€‚"
    }
  ],

  // Tab 3: éš¨å ‚æ¸¬é©— (Quizzes) - New Feature
  quizzes: [
    {
      question: "ä¸€ä½ç¤¾å·¥ä¾ç…§æœŸåˆŠä¸Šçš„æ­¥é©Ÿï¼Œåœ¨è‡ªå·±çš„æ©Ÿæ§‹å®Œå…¨é‡è¤‡äº†è©²ç ”ç©¶ï¼Œä¸¦å¾—åˆ°ç›¸ä¼¼çµæœã€‚é€™å±•ç¾äº†ç§‘å­¸æ–¹æ³•çš„å“ªä¸€ç‰¹æ€§ï¼Ÿ",
      options: [
        "ç¶“é©—æ€§ (Empirical)",
        "å¯é©—è­‰æ€§ / å¯è¤‡è£½æ€§ (Verifiable)",
        "æš«å®šæ€§ (Tentative)",
        "ç³»çµ±æ€§ (Systematic)"
      ],
      correctIndex: 1,
      explanation: "ç­”å°äº†ï¼é€™æ­£æ˜¯ã€Œå¯è¤‡è£½æ€§ã€çš„å®šç¾©ï¼šå…¶ä»–ç ”ç©¶è€…èƒ½é‡è¤‡ç¨‹åºä¸¦é©—è­‰çµæœã€‚"
    },
    {
      question: "ç¤¾å·¥åœ¨æœŸæœ«å ±å‘Šåªå‘ˆç¾ã€Œé€²æ­¥é¡¯è‘—ã€çš„å€‹æ¡ˆï¼Œå°ã€Œä¸­é€”é€€å‡ºã€çš„å€‹æ¡ˆè¼•ææ·¡å¯«ã€‚é€™ç¬¦åˆå“ªç¨®è¬¬èª¤ï¼Ÿ",
      options: [
        "éåº¦æ¦‚åŒ– (Overgeneralization)",
        "é¸æ“‡æ€§è§€å¯Ÿ (Selective Observation)",
        "æœˆæšˆæ•ˆæ‡‰ (Halo Effect)",
        "éé‚è¼¯æ¨è«– (Illogical Reasoning)"
      ],
      correctIndex: 1,
      explanation: "æ­£ç¢ºï¼åªçœ‹è¦‹æƒ³çœ‹çš„ï¼ˆæˆåŠŸçš„ï¼‰ï¼Œå¿½ç•¥ä¸æƒ³çœ‹çš„ï¼ˆå¤±æ•—çš„ï¼‰ï¼Œå°±æ˜¯é¸æ“‡æ€§è§€å¯Ÿã€‚"
    },
    {
      question: "æ ¹æ“š EBPï¼Œè‹¥è­‰æ“šé¡¯ç¤º A ç™‚æ³•æœ€æœ‰æ•ˆï¼Œä½†æ¡ˆä¸»å¼·çƒˆæ’æ–¥ä¸¦åå¥½ B ç™‚æ³•ï¼Œç¤¾å·¥ä¸æ‡‰æ€éº¼åšï¼Ÿ",
      options: [
        "å¼·è¿«æ¡ˆä¸»æ¥å— A ç™‚æ³•ï¼Œå› ç‚ºè­‰æ“šæœ€å¼·",
        "å°Šé‡æ¡ˆä¸»ï¼Œè¨è«– B ç™‚æ³•çš„è­‰æ“šèˆ‡é¢¨éšª",
        "è©•ä¼°æ˜¯å¦èƒ½ä¿®æ”¹ A ç™‚æ³•ä»¥ç¬¦åˆæ¡ˆä¸»éœ€æ±‚",
        "é‡æ–°å°‹æ‰¾ B ç™‚æ³•çš„ç›¸é—œè­‰æ“š"
      ],
      correctIndex: 0,
      explanation: "æ²’éŒ¯ï¼EBP å¼·èª¿ã€Œæ¡ˆä¸»åƒ¹å€¼ã€æ˜¯ä¸‰å¤§åŸºçŸ³ä¹‹ä¸€ï¼Œå¼·è¿«æ¡ˆä¸»é•åäº† EBP ç²¾ç¥èˆ‡å€«ç†ã€‚"
    }
  ],

  // Tab 4: è‡ªæˆ‘æª¢æ ¸ (Checklist)
  checklist: [
    "æˆ‘èƒ½å€åˆ†ã€Œç§‘å­¸æ–¹æ³•ã€èˆ‡ã€Œç›´è¦ºã€çš„å·®ç•°",
    "æˆ‘èƒ½åˆ—èˆ‰ç§‘å­¸æ–¹æ³•çš„å››å¤§ç‰¹æ€§ï¼ˆç³»çµ±ã€ç¶“é©—ã€å¯é©—è­‰ã€æš«å®šï¼‰",
    "æˆ‘èƒ½è¾¨è­˜å¸¸è¦‹çš„è§€å¯Ÿè¬¬èª¤ï¼ˆå¦‚éåº¦æ¦‚åŒ–ã€æœˆæšˆæ•ˆæ‡‰ï¼‰",
    "æˆ‘ç†è§£ EBP çš„ä¸‰å¤§åŸºçŸ³ï¼ˆè­‰æ“šã€å°ˆæ¥­ã€æ¡ˆä¸»åƒ¹å€¼ï¼‰",
    "æˆ‘è¨˜å¾— EBP çš„äº”å€‹åŸ·è¡Œæ­¥é©Ÿ (Ask, Acquire, Appraise, Apply, Assess)"
  ]
};

// ==========================================
// æ‡‰ç”¨ç¨‹å¼é‚è¼¯ (Application Logic)
// ==========================================

export default function InteractivePage() {
  const [activeTab, setActiveTab] = useState('read');
  const [currentStep, setCurrentStep] = useState(0);
  const [quizState, setQuizState] = useState({}); // Store answers for each quiz question
  const [checkedItems, setCheckedItems] = useState({});
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [showConfetti, setShowConfetti] = useState(false);

  // Checklist Logic
  const toggleCheck = (index) => {
    const nextState = { ...checkedItems, [index]: !checkedItems[index] };
    setCheckedItems(nextState);
    if (PAGE_DATA.checklist.every((_, i) => nextState[i])) {
      setShowConfetti(true);
      setTimeout(() => setShowConfetti(false), 3000);
    }
  };

  // Quiz Logic
  const handleQuizAnswer = (qIndex, optionIndex) => {
    setQuizState(prev => ({
      ...prev,
      [qIndex]: {
        selected: optionIndex,
        isCorrect: optionIndex === PAGE_DATA.quizzes[qIndex].correctIndex
      }
    }));
  };

  const stepProgress = ((currentStep + 1) / PAGE_DATA.steps.length) * 100;

  return (
    <div className="min-h-screen bg-slate-50 text-slate-800 font-sans selection:bg-blue-100 selection:text-blue-900">
      {/* Navigation */}
      <nav className="sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-slate-200 shadow-sm">
        <div className="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between h-16 items-center">
            <div className="flex items-center gap-2">
              <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold shadow-lg shadow-blue-200">
                RM
              </div>
              <span className="font-bold text-xl tracking-tight text-slate-900 hidden sm:block">Research Methods</span>
              <span className="font-bold text-xl tracking-tight text-slate-900 sm:hidden">Res. Meth.</span>
            </div>
            
            {/* Desktop Tabs */}
            <div className="hidden md:flex space-x-1 bg-slate-100 p-1 rounded-xl">
              {[
                { id: 'read', label: 'æ ¸å¿ƒçŸ¥è­˜', icon: BookOpen },
                { id: 'steps', label: 'EBP æ­¥é©Ÿ', icon: List },
                { id: 'quiz', label: 'éš¨å ‚æ¸¬é©—', icon: HelpCircle },
                { id: 'check', label: 'è‡ªæˆ‘æª¢æ ¸', icon: CheckSquare }
              ].map((tab) => (
                <button
                  key={tab.id}
                  onClick={() => setActiveTab(tab.id)}
                  className={`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${
                    activeTab === tab.id
                      ? 'bg-white text-blue-600 shadow-sm ring-1 ring-black/5'
                      : 'text-slate-500 hover:text-slate-700 hover:bg-slate-200/50'
                  }`}
                >
                  <tab.icon size={16} />
                  {tab.label}
                </button>
              ))}
            </div>

            {/* Mobile Menu Toggle */}
            <div className="md:hidden">
              <button onClick={() => setIsMenuOpen(!isMenuOpen)} className="p-2 text-slate-600 hover:bg-slate-100 rounded-lg">
                {isMenuOpen ? <X size={24} /> : <Menu size={24} />}
              </button>
            </div>
          </div>
        </div>

        {/* Mobile Menu */}
        {isMenuOpen && (
          <div className="md:hidden bg-white border-b border-slate-200 px-4 py-4 space-y-2 shadow-lg">
            {[
              { id: 'read', label: 'æ ¸å¿ƒçŸ¥è­˜', icon: BookOpen },
              { id: 'steps', label: 'EBP æ­¥é©Ÿ', icon: List },
              { id: 'quiz', label: 'éš¨å ‚æ¸¬é©—', icon: HelpCircle },
              { id: 'check', label: 'è‡ªæˆ‘æª¢æ ¸', icon: CheckSquare }
            ].map((tab) => (
              <button
                key={tab.id}
                onClick={() => { setActiveTab(tab.id); setIsMenuOpen(false); }}
                className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-base font-medium ${
                  activeTab === tab.id ? 'bg-blue-50 text-blue-600' : 'text-slate-600 hover:bg-slate-50'
                }`}
              >
                <tab.icon size={18} />
                {tab.label}
              </button>
            ))}
          </div>
        )}
      </nav>

      <main className="max-w-3xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
        {/* Header */}
        <div className="mb-10 text-center animate-fade-in">
          <span className="inline-block px-3 py-1 mb-3 text-xs font-semibold tracking-wider text-blue-600 uppercase bg-blue-50 rounded-full border border-blue-100">
            {PAGE_DATA.subtitle}
          </span>
          <h1 className="text-2xl sm:text-4xl font-extrabold text-slate-900 mb-4 leading-tight">
            {PAGE_DATA.title}
          </h1>
          <p className="text-base sm:text-lg text-slate-600 max-w-2xl mx-auto leading-relaxed">
            {PAGE_DATA.intro}
          </p>
        </div>

        <div className="min-h-[400px]">
          
          {/* TAB 1: READ */}
          {activeTab === 'read' && (
            <div className="space-y-8 animate-slide-up">
              {PAGE_DATA.sections.map((section, idx) => (
                <div key={idx} className="bg-white rounded-2xl p-6 sm:p-8 shadow-sm border border-slate-100">
                  <div className="flex items-center gap-3 mb-6 border-b border-slate-100 pb-4">
                    <h2 className="text-xl font-bold text-slate-800">{section.title}</h2>
                  </div>
                  <div className="prose prose-slate prose-blue max-w-none text-slate-600 leading-relaxed whitespace-pre-line">
                    {section.content}
                  </div>
                </div>
              ))}
              <div className="flex justify-center pt-4">
                <button 
                  onClick={() => setActiveTab('steps')}
                  className="flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-full font-medium shadow-lg shadow-blue-200 hover:bg-blue-700 transition-colors"
                >
                  ä¸‹ä¸€æ­¥ï¼šå­¸ç¿’ EBP æ­¥é©Ÿ <ChevronRight size={18} />
                </button>
              </div>
            </div>
          )}

          {/* TAB 2: STEPS (EBP) */}
          {activeTab === 'steps' && (
            <div className="animate-slide-up max-w-2xl mx-auto">
              <div className="mb-8">
                <div className="flex justify-between text-xs font-medium text-slate-500 mb-2">
                  <span>Step {currentStep + 1}</span>
                  <span>{PAGE_DATA.steps.length} Steps</span>
                </div>
                <div className="h-2 bg-slate-200 rounded-full overflow-hidden">
                  <div 
                    className="h-full bg-blue-600 transition-all duration-500 ease-out"
                    style={{ width: `${stepProgress}%` }}
                  />
                </div>
              </div>

              <div className="bg-white rounded-2xl shadow-xl shadow-slate-200/50 overflow-hidden border border-slate-100 relative">
                <div className="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
                  <span className="text-9xl font-bold text-blue-900">{currentStep + 1}</span>
                </div>
                
                <div className="p-8 min-h-[320px] flex flex-col justify-center relative z-10">
                  <span className="text-blue-600 font-bold tracking-wider text-sm uppercase mb-2">
                    EBP Process
                  </span>
                  <h2 className="text-3xl font-bold text-slate-900 mb-6">
                    {PAGE_DATA.steps[currentStep].title}
                  </h2>
                  <p className="text-slate-600 text-lg leading-relaxed mb-8">
                    {PAGE_DATA.steps[currentStep].description}
                  </p>
                  
                  {PAGE_DATA.steps[currentStep].tips && (
                    <div className="bg-amber-50 text-amber-800 px-5 py-4 rounded-xl text-sm flex gap-3 items-start border border-amber-100">
                      <Info className="flex-shrink-0 w-5 h-5 text-amber-600" />
                      <span className="leading-relaxed">{PAGE_DATA.steps[currentStep].tips}</span>
                    </div>
                  )}
                </div>

                <div className="bg-slate-50 px-8 py-5 flex justify-between items-center border-t border-slate-100">
                  <button
                    onClick={() => setCurrentStep(Math.max(0, currentStep - 1))}
                    disabled={currentStep === 0}
                    className={`flex items-center gap-1 px-4 py-2 rounded-lg font-medium transition-colors ${
                      currentStep === 0 ? 'text-slate-300 cursor-not-allowed' : 'text-slate-600 hover:bg-white hover:shadow-sm'
                    }`}
                  >
                    <ChevronLeft size={18} /> ä¸Šä¸€æ­¥
                  </button>
                  
                  <div className="flex gap-1.5">
                    {PAGE_DATA.steps.map((_, idx) => (
                      <div 
                        key={idx}
                        className={`w-2 h-2 rounded-full transition-colors ${
                          idx === currentStep ? 'bg-blue-600' : 'bg-slate-300'
                        }`}
                      />
                    ))}
                  </div>

                  <button
                    onClick={() => {
                      if (currentStep === PAGE_DATA.steps.length - 1) {
                        setActiveTab('quiz');
                      } else {
                        setCurrentStep(Math.min(PAGE_DATA.steps.length - 1, currentStep + 1));
                      }
                    }}
                    className="flex items-center gap-1 px-5 py-2.5 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 shadow-md shadow-blue-200 transition-all"
                  >
                    {currentStep === PAGE_DATA.steps.length - 1 ? 'å»æ¸¬é©—' : 'ä¸‹ä¸€æ­¥'} <ChevronRight size={18} />
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* TAB 3: QUIZ (New) */}
          {activeTab === 'quiz' && (
            <div className="animate-slide-up max-w-2xl mx-auto space-y-8">
              <div className="bg-blue-50 rounded-xl p-6 border border-blue-100 mb-6 flex gap-4">
                <div className="bg-blue-100 p-3 rounded-full h-fit">
                  <HelpCircle className="text-blue-600 w-6 h-6" />
                </div>
                <div>
                  <h3 className="font-bold text-blue-900 text-lg">éš¨å ‚æ¸¬é©—</h3>
                  <p className="text-blue-700 mt-1">è«‹æ ¹æ“šå‰é¢å­¸åˆ°çš„è§€å¿µï¼Œå›ç­”ä»¥ä¸‹å•é¡Œã€‚é»æ“Šé¸é …å³å¯æŸ¥çœ‹è§£ç­”ã€‚</p>
                </div>
              </div>

              {PAGE_DATA.quizzes.map((quiz, qIndex) => {
                const state = quizState[qIndex];
                const isAnswered = state !== undefined;
                
                return (
                  <div key={qIndex} className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                    <div className="p-6 border-b border-slate-100 bg-slate-50/50">
                      <span className="text-xs font-bold text-slate-400 uppercase tracking-wider">Question {qIndex + 1}</span>
                      <h3 className="text-lg font-semibold text-slate-800 mt-2 leading-relaxed">{quiz.question}</h3>
                    </div>
                    <div className="p-4 space-y-3">
                      {quiz.options.map((option, oIndex) => {
                        let btnClass = "w-full text-left p-4 rounded-xl border-2 transition-all duration-200 flex justify-between items-center ";
                        
                        if (!isAnswered) {
                          btnClass += "border-slate-100 hover:border-blue-200 hover:bg-blue-50 text-slate-600";
                        } else {
                          if (oIndex === quiz.correctIndex) {
                            btnClass += "border-green-500 bg-green-50 text-green-800 font-medium";
                          } else if (state.selected === oIndex && !state.isCorrect) {
                            btnClass += "border-red-300 bg-red-50 text-red-800 opacity-70";
                          } else {
                            btnClass += "border-transparent text-slate-400 opacity-50 cursor-default";
                          }
                        }

                        return (
                          <button
                            key={oIndex}
                            onClick={() => !isAnswered && handleQuizAnswer(qIndex, oIndex)}
                            disabled={isAnswered}
                            className={btnClass}
                          >
                            <span>{option}</span>
                            {isAnswered && oIndex === quiz.correctIndex && <CheckCircle className="text-green-600" size={20} />}
                            {isAnswered && state.selected === oIndex && !state.isCorrect && <XCircle className="text-red-500" size={20} />}
                          </button>
                        );
                      })}
                    </div>
                    
                    {isAnswered && (
                      <div className={`p-5 mx-4 mb-4 rounded-xl text-sm ${state.isCorrect ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                        <p className="font-bold mb-1">{state.isCorrect ? 'ğŸ‰ ç­”å°äº†ï¼' : 'ğŸ’¡ å†æƒ³ä¸€ä¸‹...'}</p>
                        <p>{quiz.explanation}</p>
                      </div>
                    )}
                  </div>
                );
              })}
            </div>
          )}

          {/* TAB 4: CHECKLIST */}
          {activeTab === 'check' && (
            <div className="animate-slide-up max-w-xl mx-auto">
              <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div className="p-6 bg-gradient-to-r from-blue-50 to-white border-b border-slate-100">
                  <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                    <Award className="text-blue-600" />
                    å­¸ç¿’æˆæ•ˆæª¢æ ¸
                  </h2>
                  <p className="text-slate-500 text-sm mt-1">
                    å®Œæˆæ‰€æœ‰é–±è®€èˆ‡æ¸¬é©—å¾Œï¼Œè«‹å‹¾é¸ä»¥ä¸‹é …ç›®ç¢ºèªã€‚
                  </p>
                </div>
                
                <div className="divide-y divide-slate-100">
                  {PAGE_DATA.checklist.map((item, idx) => (
                    <label 
                      key={idx} 
                      className={`flex items-start gap-4 p-5 cursor-pointer hover:bg-slate-50 transition-colors ${
                        checkedItems[idx] ? 'bg-blue-50/30' : ''
                      }`}
                    >
                      <div className="relative flex items-center mt-0.5">
                        <input
                          type="checkbox"
                          className="peer h-5 w-5 cursor-pointer appearance-none rounded-md border-2 border-slate-300 transition-all checked:border-blue-500 checked:bg-blue-500 hover:border-blue-400"
                          checked={!!checkedItems[idx]}
                          onChange={() => toggleCheck(idx)}
                        />
                        <div className="pointer-events-none absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-white opacity-0 peer-checked:opacity-100">
                          <svg xmlns="http://www.w3.org/2000/svg" className="h-3.5 w-3.5" viewBox="0 0 20 20" fill="currentColor">
                            <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                          </svg>
                        </div>
                      </div>
                      <span className={`text-base transition-all ${
                        checkedItems[idx] ? 'text-slate-400 line-through' : 'text-slate-700'
                      }`}>
                        {item}
                      </span>
                    </label>
                  ))}
                </div>
                
                {showConfetti && (
                  <div className="p-4 bg-green-100 text-green-800 text-center font-medium animate-pulse">
                    ğŸ‰ æ­å–œï¼æ‚¨å·²å®Œæˆæœ¬ç« ç¯€çš„æ‰€æœ‰å­¸ç¿’ç›®æ¨™ï¼
                  </div>
                )}
              </div>
            </div>
          )}

        </div>
      </main>

      <footer className="border-t border-slate-200 bg-white mt-20 py-8">
        <div className="max-w-5xl mx-auto px-4 text-center text-slate-400 text-sm">
          <p>Â© ç ”ç©¶æ–¹æ³•äº’å‹•è¬›ç¾©</p>
        </div>
      </footer>

      <style>{`
        @keyframes slide-up {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fade-in {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        .animate-slide-up {
          animation: slide-up 0.4s ease-out forwards;
        }
        .animate-fade-in {
          animation: fade-in 0.6s ease-out forwards;
        }
      `}</style>
    </div>
  );
}
