<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>社會工作理論(三)隨機測驗</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif;
      background: #f8f6ff;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 700px;
      margin: 32px auto;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.10);
      padding: 32px 24px 24px 24px;
    }
    h1 {
      margin-top: 0;
      font-size: 2.2rem;
      color: #6c5ce7;
      text-align: center;
      letter-spacing: 2px;
    }
    h2 {
      font-size: 1.1rem;
      color: #b2bec3;
      text-align: center;
      font-weight: normal;
      margin-top: 0;
      margin-bottom: 24px;
    }
    .btn-group {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin: 24px 0 32px 0;
    }
    button {
      background: linear-gradient(90deg,#fdcbf1 0%,#a1c4fd 100%);
      color: #2d3436;
      border: none;
      border-radius: 8px;
      padding: 14px 32px;
      font-size: 1.2rem;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(200,200,200,0.10);
      transition: background 0.2s;
    }
    button:hover, button:focus {
      background: linear-gradient(90deg,#a1c4fd 0%,#fdcbf1 100%);
    }
    .progress {
      height: 12px;
      background: #ffeaa7;
      border-radius: 6px;
      margin-bottom: 24px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: #fab1a0;
      width: 0%;
      transition: width 0.3s;
    }
    .question-card {
      margin-bottom: 24px;
    }
    .question {
      font-size: 1.3rem;
      margin-bottom: 18px;
      color: #00b894;
      font-weight: bold;
    }
    .options {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    .option {
      background: #ffeaa7;
      border: 2px solid #fdcbf1;
      border-radius: 10px;
      padding: 16px 18px;
      cursor: pointer;
      font-size: 1.15rem;
      font-weight: bold;
      transition: background 0.2s, border 0.2s;
      display: flex;
      align-items: center;
      letter-spacing: 1px;
    }
    .option.selected {
      background: #a1c4fd;
      border: 2px solid #6c5ce7;
      color: #2d3436;
    }
    .option.correct {
      background: #dff9fb;
      border: 2px solid #00b894;
      color: #00b894;
    }
    .option.incorrect {
      background: #fab1a0;
      border: 2px solid #d63031;
      color: #d63031;
    }
    .actions {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      margin-top: 24px;
    }
    .timer {
      text-align: right;
      font-size: 1.1rem;
      color: #636e72;
      margin-bottom: 12px;
      font-weight: bold;
    }
    .summary {
      text-align: center;
      margin-top: 32px;
    }
    .score {
      font-size: 2rem;
      color: #00b894;
      margin-bottom: 12px;
      font-weight: bold;
    }
    .review {
      margin-top: 32px;
      background: #f8fafc;
      border-radius: 12px;
      padding: 18px 12px;
    }
    .review h3 {
      margin-top: 0;
      color: #6c5ce7;
      font-size: 1.2rem;
    }
    .review-item {
      margin-bottom: 18px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e0e7ef;
    }
    .review-item:last-child {
      border-bottom: none;
    }
    .review-q {
      font-weight: bold;
      color: #00b894;
      font-size: 1.1rem;
    }
    .review-a {
      margin-left: 8px;
      font-size: 1rem;
    }
    .review-correct {
      color: #00b894;
      font-weight: bold;
    }
    .review-wrong {
      color: #d63031;
      font-weight: bold;
    }
    .download-group {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-top: 24px;
    }
    @media (max-width: 700px) {
      .container { padding: 12px 2px 8px 2px; }
      h1 { font-size: 1.3rem; }
      .question { font-size: 1.1rem; }
      .option { font-size: 1rem; }
    }
  </style>
</head>
<body>
  <div class="container" id="app"></div>
  <script>
// 題庫資料（40題，已隨機排列）
const questions = [
  {q:"精神醫療社會工作早期以病理取向為主，近期轉變為強調優勢取向。請問優勢取向對精神治療與康復之看法，下列何者正確？",options:["精神疾病的治療最重要的是藥物治療，精神病患必須完全遵從醫囑","精神病患和普通人一樣有正常的需求、能力和潛能","專業人員在精神疾病的治療和康復中是具有權威和力量，只有專業人員才真正了解精神病患的需要","社區民眾的角色不重要，因為只有當精神病患不斷服藥和接受訓練時，才能回歸社區"],answer:1},
  {q:"下列社會工作理論或觀點對人的問題的敘述，何者正確？",options:["心理暨社會學派傾向認為人的問題全部來自早期未竟事宜所引發的內在心理衝突與自我防衛機轉失靈","生態系統觀點傾向認為人的問題來自非理性的信念與不良的自我功能","增強權能觀點傾向認為人的問題來自長期負面評價所帶來的個人心理無力感，及優勢團體壓迫所帶來的機會剝奪","社會網絡處遇學派傾向認為人的問題來自資本主義政治經濟結構對於弱勢群體所帶來的不公"],answer:2},
  {q:"Turner(1986)認為社會工作者在實務工作中強調理論的可運用性，可能會面臨的挑戰：①不重視個別化 ②過度強調分類 ③缺乏彈性 ④與人文取向為基礎的實務工作一致",options:["①②④","①③④","②③④","①②③"],answer:3},
  {q:"有關靈性(spirituality)觀點在社會工作的運用，下列敘述何者正確？①社會工作強調身、心、靈、社會的全人關懷理念 ②社會工作專業早在19世紀末興起時，已經和宗教與靈性產生密切關係③社會工作的靈性觀點強調一種物質的世界 ④強調身、心、靈及社會彼此間的關係",options:["①②③","②③④","①②④","①③④"],answer:2},
  {q:"關於增權(empowerment)對於社會工作實務的意義，下列敘述何者錯誤？",options:["重視案主的優勢與能力","強調社會工作者和案主的合作關係","增強個人與家庭的權力整合","對結構的批判性反思"],answer:3},
  {q:"社會工作的處遇方式，近年來強調對案主「empowerment」，這個字的意思是：",options:["自決","充權","機會","診斷"],answer:1},
  {q:"有關個人復原力，下列敘述何者正確？①復原力是一個動態的過程，是一種良好的適應，是一種個人力量的恢復②從結構的觀點來看，復原力是個人處於社會結構的結果③社會工作者必須以建構保護因子為目標，培養弱勢者的復原力④復原力主要是個人先天具備的某些能力特質，而非後天環境重要因素所培育而成",options:["①②③","①③④","②③④","①②④"],answer:0},
  {q:"有關優勢觀點的社會工作實務，下列敘述何者錯誤？",options:["與服務使用者協力工作","採取樂觀的態度","建立在成功經驗的基礎上","社會工作者是問題解決的專家"],answer:3},
  {q:"敘事治療(narrative therapy)被認為是利用後現代理論觀點於社會工作實務的重要方式，其在實務運用上的四個原則，下列何者不在其中？",options:["把焦點放在形成服務使用者生活的敘事和描述","把焦點放在協助個人面對問題、解決問題","用生存、勇氣、責任和積極抵抗來重新建構自己的生命故事","與案主形成平等且尊重的夥伴關係"],answer:1},
  {q:"下列與優勢觀點有關的敘述，何者錯誤？",options:["社會工作專業主張優勢觀點，與刑事司法體系強調社會控制與懲罰的目標衝突","優勢觀點運用在刑事司法體系上的首要目標是預防、處遇和矯治","在監獄當中運用優勢警力是有效的嚇阻策略","應提供受刑人有效治療、教育機會和工作技巧訓練的管道"],answer:2},
  {q:"Barbara Solomon在1976年出版的「Black Empowerment：Social Work in Oppressed Communities」書中開始使用「增強權能」這個名詞。下列那一個概念不是她書中主要的概念？",options:["無力感","制度性種族主義","高層次的同理心","壓迫與疏離"],answer:2},
  {q:"優勢社會工作觀點的學者Rapp(2006)提出實務運作發展的6個假設，下列何者錯誤？",options:["個人有能力去學習、成長和改變","處遇的焦點在於個人的優點，而非病理","社工是助人關係的指導者","社區是一個資源的綠洲"],answer:2},
  {q:"學者Healy，K.(2005)提出三項觀點說明「理論建構」在社會工作專業發展的位置，下列何者錯誤？",options:["社會工作者無暇發展實務研究，可直觀地運用經驗處遇","社會工作者必須向服務使用者與經費提供者負責","社會工作者必須能不斷改善服務品質","社會工作者有責任去參與專業理論的發展，以促進專業不斷進步"],answer:0},
  {q:"如果你/妳採用增強權能理論與弱勢案主工作，下列何者不是你/妳的工作取向的基本假設？",options:["與案主建立協同的夥伴關係","案主的問題源自於社會功能障礙","認為案主是一個有能力且有價值的人","案主問題源於無力感以致無法與環境交流、實現自己"],answer:1},
  {q:"下列何者不是Solomon在1976年提出的增強權能干預的元素？",options:["協助案主體認自己是自己問題的改變媒介","協助案主體認社會工作者的知識和技術是具有專業性的","協助案主體認社會工作者只是其努力解決問題的夥伴","協助案主體認無力感其實是可以被影響而改變的"],answer:1},
  {q:"下列那個概念及工作方法是最早提出的？",options:["增權","焦點解決","正向心理學","敘事治療"],answer:0},
  {q:"實踐「個人和政治權力的啟動，獲致感覺個人有能力和肯定自己的經驗，並進而能獲取機會、連結資源、採取行動以對抗社會控制」等主張，最接近下列那一個社會工作理論觀點？",options:["生態系統理論","充權與倡導觀點","心理及社會學派","多元文化觀點"],answer:1},
  {q:"優勢觀點為社會工作經常運用原則，請問以下敘述何者錯誤？",options:["挑戰可能帶來威脅，但也可能是機會來源","透過專業人員與案主共同合作，案主方能獲得最好的服務","每個個人、團體和社區都有其優勢","評量環境中的情境與個人"],answer:1},
  {q:"有關優勢觀點的理論假設，下列何者正確？1每個人都有優勢2社會工作者要促進個人對制度壓迫的覺察3童年經驗會決定個人如何反應4人在面對逆境時通常會展現復原力5服務使用者有能力決定什麼是對他們最好的",options:["145","124","125","123"],answer:0},
  {q:"下列何者屬於「間接權能障礙」？",options:["貧窮者被標籤為福利依賴者","案主所需的醫療資源不足","限制案家取得生活扶助的資格","案主的童年創傷沒有被處理"],answer:0},
  {q:"增強權能(empowerment)是一種歷程，目的在協助服務對象取得決定權與行動權。對於此歷程的介入策略之敘述，下列何者錯誤？",options:["發展個人與人連結的能力來抵抗制度性壓迫","鼓勵服務對象透過社會互動促進更多的個人與人際權能","增進服務對象因應與改變環境的技巧","協助服務對象爭取生活資源"],answer:3},
  {q:"有關優勢觀點，下列敘述何者錯誤？",options:["Rapp(1998)指出優勢觀點的三大基本優勢為能力(competencies)、自信(confidence)和自我抉擇能力(self-determination)","案主在面對逆境時的勇氣和復原力，教導我們人性的可貴","此模式肯定人類內在的智慧和蛻變的能力","此模式重點在於案主看其問題與處境的視野改變，超越問題，看到改變的可能性"],answer:0},
  {q:"有關家庭復原力(family resilience)的敘述，下列何者正確？",options:["復原力的展現必須是在面對重大家庭逆境時才會出現","家庭信念系統是家庭復原力的核心","家庭成員要能儘量表達對彼此真實的不滿","具有復原力的家庭是無壓力的"],answer:1},
  {q:"增權觀點在美國的起源跟下列那一個族群密切相關？",options:["低收入戶","心理疾病患者","少數民族","老人"],answer:2},
  {q:"「優勢觀點」(strengths perspective)的核心理念，下列何者錯誤？",options:["肯定與促進服務對象的能力","在個人生態脈絡中產生復原力","以角色示範來增進服務對象的角色學習","讓服務對象產生有資源感"],answer:2},
  {q:"優勢觀點的敘述，下列何者正確？1優勢觀點的發源地來自西歐的英國 2優勢觀點與焦點解決有強烈的相關性 3優勢觀點強調探索案主未來的可能性 4優勢觀點強調個人不是問題",options:["123","124","234","134"],answer:2},
  {q:"學者Bernard指出具有「復原力」的兒童擁有四種能力，下列何者錯誤？",options:["社會能力","問題解決能力","依賴能力","對未來具有目標感"],answer:2},
  {q:"下列何者不是後現代社會工作的觀點？",options:["強調實務知識是由社會工作者和案主互動過程中創造出來的","強調情境參與者的直觀，透過社會論述可建構知識","強調所有參與者是平權的，因此社會工作者應抱持謙虛的態度","強調社會工作評量是一個了解問題和情境的過程，因此陪伴案主尋找自己內在的問題，使治療更有效能"],answer:3},
  {q:"下列有關「充權」理論的敘述，何者錯誤？",options:["充權在社會工作領域中，代表的是協助案主在其生活歷程中獲得力量與權力","充權的引導原則中，其中一種方式便是將重點放在檢視案主的優勢方面","充權主要的焦點只在於消除壓迫案主之環境因素，而非案主個人能力的提升","在充權的過程中，案主必須先相信自己有能力為自己做某些事情，而後才能為自己的生活及生活以外的事件，增加主導與控制權"],answer:2},
  {q:"「優勢觀點」已獲得社會工作實務界之認可與運用，但此觀點的限制為何？",options:["忽略結構面所帶來的壓迫","忽略個案的學習能力","忽視社區所潛藏的資源","忽視社會工作者與個案的合作關係"],answer:0},
  {q:"有關美國衛生及公共服務部(Department of Health and Human Services)提出復原概念的十大原則，不包括下列何種原則？",options:["直線的過程(Linear)","全人關懷(Holistic)","以個人及個體為本(Individualized and Person Centered)","自我取向(Self Direction)"],answer:0},
  {q:"下列何者為採優勢觀點個案管理者的任務？1協助案主覺察其問題的成因2促進案主澄清與確定目標3增強案主運用自然資源4協助案主確認其目標的意義與重要性",options:["1234","僅123","僅234","僅134"],answer:0},
  {q:"社會工作者應與身障者建立「充權」的專業關係，下列何者不適用於「充權」敘述？",options:["案主自決的倫理原則是促進社會融合的先決條件，應該視身障者為專家","應依據過去的服務紀錄來判斷身障者的需求，而非只是聽從身障者自己的想法","擴大身障者在日常生活中的選擇機會，提供積極復健計畫以增加自主與獨立","體會身障者被邊緣化與烙印的感受，協助其面對與家人和社區的社會互動"],answer:1},
  {q:"有關後現代敘事治療的主要論點，下列何者正確？",options:["社會工作者必須關注對服務使用者產生阻礙的結構和文化議題","社會工作者必須採取樂觀和正向態度質疑病理的論述","個人必須覺察社會壓迫的形式和權力流動","自身與他人建構出來的敘述可以形塑人們的經驗，以及對自我的覺察和生命的選擇"],answer:3},
  {q:"所謂「優勢觀點」(strengths perspective)的社會工作模型，其核心概念不包含以下那一點？",options:["發現並協助案主發掘潛在的資源","聚焦於案主的優勢","肯定及促進案主的能力","協助案主發現問題比解決其問題重要"],answer:3},
  {q:"「充權」案主是社會工作者的工作目標，下列何者屬於案主消權？①與拒絕申請保護令案主，討論返家後續安全計畫 ②說服從事季節性工作案主，接受職訓找薪水穩定的工作 ③與獨居老人討論安裝緊急救援系統，以降低獨居風險 ④說服未婚懷孕青少女要出養嬰兒，才能接續完成高中學業",options:["①②","③④","②④","①③"],answer:2},
  {q:"根據所羅門(Solomon，1976)的觀點，社會工作者在運用增權觀點時，應具備下列那一條件？",options:["能協助案主看到他本身即為有助於問題改變的一個力量","能協助案主無條件接受社會工作者所具備的知識與技巧","幫案主抵抗外在的威脅","能協助案主順服社會工作者，以做為啟動問題解決的核心"],answer:0},
  {q:"佛雷勒(Freire)提出增權的倡導策略，屬於下列何種類型？",options:["廣義的社會教育","廣義的社會運動","廣義的社會革命","廣義的社會秩序"],answer:0},
  {q:"強調看見案主身處的壓迫情境、追溯被壓迫團體的社會歷史、看見階級、種族、性別等歧視的交互作用，讓人們管理、控制他們對需求和資源的定義。下列何者最符合此項定義的社會工作理論？",options:["基變社會工作","多元文化主義","增強權能理論","生態系統理論"],answer:2},
  {q:"請問下列何者並非增強權能觀點社會工作取向的基本假設？",options:["承諾保護個人免於受剝削或壓迫","個人經驗深切且無力感，以致無法與環境交流實現自己","權能可以透過社會互動增加衍生更多的權能","案主被視為有能力、有價值的個人"],answer:0}
];

const app = document.getElementById('app');
let quizState = {
  quizStarted: false,
  quizFinished: false,
  totalQuestions: 0,
  current: 0,
  userAnswers: [],
  quizQuestions: [],
  quizOptions: [],
  timer: 0,
  timerInterval: null
};

function shuffle(array) {
  let currentIndex = array.length, randomIndex;
  while (currentIndex !== 0) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;
    [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
  }
  return array;
}

function shuffleOptions(q) {
  let idxArr = Array.from({length: q.options.length}, (_, i) => i);
  shuffle(idxArr);
  return idxArr;
}

function renderHome() {
  quizState.quizStarted = false;
  quizState.quizFinished = false;
  app.innerHTML = `
    <h1>社會工作理論(三)</h1>
    <h2>(從總題庫抽出40題)</h2>
    <div class="btn-group">
      <button onclick="startQuiz(5)">5題測驗</button>
      <button onclick="startQuiz(10)">10題測驗</button>
    </div>
  `;
}

window.startQuiz = function(num) {
  quizState.quizStarted = true;
  quizState.quizFinished = false;
  quizState.totalQuestions = num;
  quizState.current = 0;
  quizState.userAnswers = [];
  quizState.timer = 0;
  // 隨機抽題（不重複）
  let idxArr = Array.from({length: questions.length}, (_, i) => i);
  shuffle(idxArr);
  quizState.quizQuestions = idxArr.slice(0, num).map(i => questions[i]);
  quizState.quizOptions = quizState.quizQuestions.map(q => shuffleOptions(q));
  renderQuiz();
  if (quizState.timerInterval) clearInterval(quizState.timerInterval);
  quizState.timerInterval = setInterval(() => {
    quizState.timer++;
    if (quizState.quizStarted && !quizState.quizFinished) {
      document.getElementById('timer').innerText = formatTime(quizState.timer);
    }
  }, 1000);
}

function formatTime(sec) {
  let m = Math.floor(sec/60);
  let s = sec%60;
  return `${m}:${s.toString().padStart(2,'0')}`;
}

function renderQuiz() {
  const q = quizState.quizQuestions[quizState.current];
  const optOrder = quizState.quizOptions[quizState.current];
  const userAns = quizState.userAnswers[quizState.current];
  const progress = ((quizState.current) / quizState.totalQuestions) * 100;
  app.innerHTML = `
    <h1>社會工作理論(三)</h1>
    <h2>(從總題庫抽出40題)</h2>
    <div class="timer">時間：<span id="timer">${formatTime(quizState.timer)}</span></div>
    <div class="progress"><div class="progress-bar" style="width:${progress}%;"></div></div>
    <div class="question-card">
      <div class="question">${q.q}</div>
      <div class="options">
        ${optOrder.map((idx, i) => `
          <div class="option${userAns === i ? ' selected' : ''}" onclick="selectOption(${i})">
            <span style="font-weight:bold;margin-right:8px;">${String.fromCharCode(65+i)}.</span> ${q.options[idx]}
          </div>
        `).join('')}
      </div>
    </div>
    <div class="actions">
      <button onclick="prevQ()" ${quizState.current === 0 ? 'disabled' : ''}>上一題</button>
      <button onclick="nextQ()">${quizState.current === quizState.totalQuestions - 1 ? '繳交' : '下一題'}</button>
    </div>
  `;
}

window.selectOption = function(idx) {
  quizState.userAnswers[quizState.current] = idx;
  renderQuiz();
}

window.prevQ = function() {
  if (quizState.current > 0) {
    quizState.current--;
    renderQuiz();
  }
}

window.nextQ = function() {
  if (quizState.userAnswers[quizState.current] === undefined) {
    alert('請先選擇答案！');
    return;
  }
  if (quizState.current < quizState.totalQuestions - 1) {
    quizState.current++;
    renderQuiz();
  } else {
    finishQuiz();
  }
}

function finishQuiz() {
  quizState.quizFinished = true;
  quizState.quizStarted = false;
  clearInterval(quizState.timerInterval);
  let correct = 0;
  let detail = [];
  quizState.quizQuestions.forEach((q, i) => {
    const optOrder = quizState.quizOptions[i];
    const userIdx = quizState.userAnswers[i];
    const correctIdx = optOrder.indexOf(q.answer);
    if (userIdx === correctIdx) correct++;
    detail.push({
      q: q.q,
      options: optOrder.map(idx => q.options[idx]),
      user: userIdx,
      correct: correctIdx
    });
  });
  app.innerHTML = `
    <h1>社會工作理論(三)</h1>
    <h2>(從總題庫抽出40題)</h2>
    <div class="summary">
      <div class="score">得分：${correct} / ${quizState.totalQuestions}</div>
      <div>正確：<span style="color:#00b894;font-weight:bold;">${correct}</span>　錯誤：<span style="color:#d63031;font-weight:bold;">${quizState.totalQuestions - correct}</span></div>
      <div>作答時間：${formatTime(quizState.timer)}</div>
      <button style="margin-top:24px;" onclick="renderHome()">重新開始</button>
    </div>
    <div class="download-group">
      <button onclick="downloadPDF()">下載PDF</button>
      <button onclick="downloadCSV()">下載CSV</button>
    </div>
    <div class="review">
      <h3>答題詳解</h3>
      ${detail.map((d, i) => {
        const isCorrect = d.user === d.correct;
        return `
          <div class="review-item">
            <div class="review-q">${i+1}. ${d.q}</div>
            <div class="review-a">
              你的答案：<span class="${isCorrect ? 'review-correct' : 'review-wrong'}">${d.user !== undefined ? String.fromCharCode(65+d.user) + '. ' + d.options[d.user] : '未作答'}</span><br>
              正確答案：<span class="review-correct">${String.fromCharCode(65+d.correct)}. ${d.options[d.correct]}</span>
            </div>
          </div>
        `;
      }).join('')}
    </div>
  `;
}

window.downloadPDF = function() {
  const { jsPDF } = window.jspdf;
  let doc = new jsPDF();
  let y = 20;
  doc.setFontSize(18);
  doc.text('社會工作理論(三) 測驗詳解', 15, y);
  y += 10;
  doc.setFontSize(12);
  doc.text(`得分：${quizState.userAnswers.filter((ans, i) => {
    const optOrder = quizState.quizOptions[i];
    return ans === optOrder.indexOf(quizState.quizQuestions[i].answer);
  }).length} / ${quizState.totalQuestions}  時間：${formatTime(quizState.timer)}`, 15, y);
  y += 10;
  quizState.quizQuestions.forEach((q, i) => {
    const optOrder = quizState.quizOptions[i];
    const userIdx = quizState.userAnswers[i];
    const correctIdx = optOrder.indexOf(q.answer);
    doc.text(`${i+1}. ${q.q}`, 15, y);
    y += 8;
    optOrder.forEach((idx, j) => {
      let mark = '';
      if (j === correctIdx) mark = ' (正確)';
      if (j === userIdx) mark += ' (你的答案)';
      doc.text(`${String.fromCharCode(65+j)}. ${q.options[idx]}${mark}`, 20, y);
      y += 7;
      if (y > 270) { doc.addPage(); y = 20; }
    });
    y += 4;
    if (y > 270) { doc.addPage(); y = 20; }
  });
  doc.save('社會工作理論三_測驗詳解.pdf');
}

window.downloadCSV = function() {
  let csv = '題號,題目,你的答案,正確答案\n';
  quizState.quizQuestions.forEach((q, i) => {
    const optOrder = quizState.quizOptions[i];
    const userIdx = quizState.userAnswers[i];
    const correctIdx = optOrder.indexOf(q.answer);
    csv += `${i+1},"${q.q}","${userIdx !== undefined ? String.fromCharCode(65+userIdx)+'. '+q.options[optOrder[userIdx]] : '未作答'}","${String.fromCharCode(65+correctIdx)+'. '+q.options[optOrder[correctIdx]]}"\n`;
  });
  const blob = new Blob([csv], {type: 'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = '社會工作理論三_測驗詳解.csv';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

renderHome();
  </script>
</body>
</html>
